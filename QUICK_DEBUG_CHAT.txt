â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ› QUICK DEBUG GUIDE: ENVIO DE MENSAGENS NO CHAT                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸ” BUSCAR LOGS NO TERMINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¤ MENSAGEM SENDO ENVIADA:
   flutter logs | grep "ğŸ“¤"

   Esperado:
   I/flutter (12345): ğŸ“¤ Enviando mensagem de userId1 para userId2
   I/flutter (12345): ğŸ“¤ Repository.sendMessage: senderId=..., receiverId=...
   I/flutter (12345): ğŸ“¤ DataSource.sendMessage START

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¥ MENSAGENS SENDO CARREGADAS:
   flutter logs | grep "ğŸ“¥"

   Esperado:
   I/flutter (12345): ğŸ“¥ Carregando mensagens para: conversationId

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… SUCESSO:
   flutter logs | grep "âœ…"

   Esperado:
   I/flutter (12345): âœ… Mensagem enviada com sucesso: messageId
   I/flutter (12345): âœ… Conversa criada automaticamente

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ ERROS:
   flutter logs | grep "âŒ"

   Se houver, significa que algo deu errado!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ’¡ CRIAÃ‡ÃƒO AUTOMÃTICA:
   flutter logs | grep "ğŸ’¡"

   Indicador: Conversa estÃ¡ sendo criada automaticamente

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸ”¥ VERIFICAR FIREBASE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. VERIFICAR CONVERSA CRIADA:
   Firestore â†’ organizations/default/conversations/
   
   Procure por: {userId1}-{userId2} (IMPORTANTE: hÃ­fen, nÃ£o underscore)
   
   Exemplo: 
   - badId_with_underscore âŒ (ERRADO)
   + goodId-with-hyphen âœ… (CORRETO)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2. VERIFICAR MENSAGEM SALVA:
   Firestore â†’ organizations/default/conversations/{id1}-{id2}/messages/
   
   Campos esperados:
   - id: "messageId"
   - senderId: "id do remetente"
   - receiverId: "id do destinatÃ¡rio"
   - text: "conteÃºdo da mensagem"
   - timestamp: "2025-10-27 19:45:00"
   - isRead: false
   - conversationId: "{id1}-{id2}"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3. VERIFICAR CONVERSA METADATA:
   Firestore â†’ organizations/default/conversations/{id1}-{id2}/
   
   Campos que devem estar:
   - participants: [userId1, userId2]
   - lastMessage: {...} (objeto da Ãºltima mensagem)
   - updatedAt: "Ãºltima atualizaÃ§Ã£o"
   - "{userId1}_unread": 0
   - "{userId2}_unread": 1 (se nÃ£o leu)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸš¨ DIAGNÃ“STICO RÃPIDO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA: Mensagem nÃ£o aparece na tela
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verifique logs: hÃ¡ âŒ ERROS?
âœ“ Verifique Firebase: mensagem estÃ¡ em /messages/?
âœ“ Verifique conversationId: usa hÃ­fen (-)?
âœ“ Verifique timestamp: estÃ¡ recente?

PROBLEMA: Conversa nÃ£o Ã© encontrada
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verifique Firebase: conversa existe em /conversations/?
âœ“ Verifique ID: Ã© userId1-userId2 (com hÃ­fen)?
âœ“ Verifique participants: contÃ©m os dois userIds?
âœ“ Verifique sort: estÃ¡ alfabÃ©tico? (userId1 < userId2)

PROBLEMA: PERMISSION_DENIED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verificar autenticaÃ§Ã£o: usuÃ¡rio autenticado?
âœ“ Verificar status: usuÃ¡rio ativo (isActive)?
âœ“ Verificar rules: /messages estÃ¡ dentro de /conversations?
âœ“ Verificar participants: usuÃ¡rio Ã© participante da conversa?

PROBLEMA: Nenhum log aparece
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ âš ï¸ Significa que _sendMessage() nem foi chamada
âœ“ Verifique: input estÃ¡ vazio?
âœ“ Verifique: _conversationId Ã© null?
âœ“ Verifique: senderId estÃ¡ vazio?

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸ”§ FLOW DE ENVIO DE MENSAGEM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

USER CLICA BOTÃƒO "ENVIAR"
     â†“
IndividualChatScreen._sendMessage()
     â†“ (LOG: ğŸ“¤ Enviando mensagem de... para...)
ChatProvider.sendMessage()
     â†“ (LOG: ğŸ“¤ ChatProvider.sendMessage: sending...)
SendMessage UseCase.call()
     â†“
ChatRepository.sendMessage()
     â†“ (LOG: ğŸ“¤ Repository.sendMessage)
     â†“ (Valida conversa existe)
     â†“ (LOG: ğŸ’¡ Criando conversa se nÃ£o existir)
FirebaseChatDataSource.sendMessage()
     â†“ (LOG: ğŸ“¤ DataSource.sendMessage START)
     â†“ (LOG: ğŸ’¾ Salvando mensagem)
     â†“ (LOG: ğŸ”„ Atualizando metadata)
FIREBASE â† Mensagem Salva
     â†“ (LOG: âœ… Mensagem enviada com sucesso)
Provider â† Atualiza estado
     â†“
UI â† Mostra mensagem

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸ“Š ORDEM ALFABÃ‰TICA (IMPORTANTE!)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ConversationId SEMPRE deve estar em ordem alfabÃ©tica!

EXEMPLO:
â”œâ”€ userId1 = "abc123"
â”œâ”€ userId2 = "xyz789"
â”‚
â””â”€ SORT ALFABÃ‰TICO
   â”œâ”€ "abc123" < "xyz789" âœ…
   â””â”€ conversationId = "abc123-xyz789"

SE INVERTIDO:
â”œâ”€ senderId = "xyz789"
â”œâ”€ receiverId = "abc123"
â”‚
â”œâ”€ ANTES (ERRADO): "xyz789-abc123" âŒ
â””â”€ AGORA (CORRETO): sort primeiro â†’ "abc123-xyz789" âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ğŸ“ EXEMPLO DE LOGS BOM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

I/flutter ( 8888): ğŸ”— startConversation: userId123 <-> userId456 => userId123-userId456
I/flutter ( 8888): ğŸ“¥ Carregando mensagens para: userId123-userId456
I/flutter ( 8888): âœ“ Mensagens carregadas: 3 mensagens
I/flutter ( 8888): ğŸ“¤ ChatProvider.sendMessage: sending "OlÃ¡!"
I/flutter ( 8888): ğŸ“¤ Repository.sendMessage: senderId=userId123, receiverId=userId456 => conversationId=userId123-userId456
I/flutter ( 8888): âœ“ Conversa encontrada: userId123-userId456
I/flutter ( 8888): ğŸ“¤ DataSource.sendMessage START: conversationId=userId123-userId456, senderId=userId123
I/flutter ( 8888): ğŸ’¾ Salvando mensagem: msg_abc123
I/flutter ( 8888): âœ“ Mensagem salva com sucesso
I/flutter ( 8888): ğŸ”„ Atualizando metadata da conversa...
I/flutter ( 8888): âœ… Conversa atualizada - Mensagem enviada com sucesso: msg_abc123
I/flutter ( 8888): âœ… Mensagem enviada com sucesso: msg_abc123

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 âŒ EXEMPLO DE LOGS RUIM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

W/Firestore(XXXX): PERMISSION_DENIED
I/flutter ( 8888): âŒ Conversa nÃ£o encontrada: userId456-userId123
I/flutter ( 8888): âŒ Erro ao enviar mensagem

^ INDICATIVO: conversationId com ordem errada!
  Esperado: userId123-userId456
  Recebido: userId456-userId123

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 âš¡ DICAS RÃPIDAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Nenhum log? â†’ _conversationId Ã© null
2. Logs mas sem âœ…? â†’ Verifique Firebase permissions
3. Conversa nÃ£o achada? â†’ ConversationId nÃ£o estÃ¡ em ordem alfabÃ©tica
4. PERMISSION_DENIED? â†’ UsuÃ¡rio nÃ£o Ã© participante ou rules erradas
5. Mensagem nÃ£o persiste? â†’ Verifique se salvou em /messages/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Arquivo: CHAT_FIXES_ENVIO_MENSAGENS.md (para mais detalhes)
Data: 27 de outubro de 2025

â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
